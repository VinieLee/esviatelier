<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esvi Atelier - Moda y Estilo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Armon√≠a Natural (Blanco Roto, Gris Carb√≥n, Verde Oliva Sutil) -->
    <!-- Application Structure Plan: Se ha dise√±ado una Single-Page Application (SPA) para maximizar la fluidez. El usuario nunca abandona la p√°gina principal. La navegaci√≥n por categor√≠as y los filtros actualizan la vista de productos din√°micamente. Al hacer clic en un producto, un modal superpuesto muestra los detalles, manteniendo el contexto. El carrito es un panel lateral deslizable para un acceso r√°pido y el checkout es una secuencia de modales que gu√≠an al usuario paso a paso. Esta arquitectura SPA fue elegida por su velocidad, experiencia de usuario moderna y capacidad para mantener al usuario enganchado sin las interrupciones de las recargas de p√°gina tradicionales. -->
    <!-- Visualization & Content Choices: Report Info: Listado de productos y filtros -> Goal: Organizar y Comparar -> Viz/Presentation Method: Cuadr√≠cula de tarjetas de productos en HTML/Tailwind para una f√°cil comparaci√≥n visual. Barra lateral con controles de formulario (checkboxes, slider) para el filtrado -> Interaction: JS actualiza la cuadr√≠cula en tiempo real seg√∫n la selecci√≥n del usuario. Report Info: Detalles del producto -> Goal: Informar en profundidad -> Viz/Presentation: Modal superpuesto que enfoca la atenci√≥n -> Interaction: Selecci√≥n de talla/color y bot√≥n "Agregar al Carrito" que actualiza el estado de la app. Report Info: Carrito y Checkout -> Goal: Gestionar compra -> Viz/Presentation: Panel lateral y modales secuenciales -> Interaction: JS gestiona el estado del carrito, los c√°lculos de totales y la progresi√≥n a trav√©s de los pasos de pago. Library/Method: Vanilla JS para toda la l√≥gica, TailwindCSS para el layout. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #F8F7F5; /* Blanco Roto */
            color: #333333; /* Gris Carb√≥n */
        }
        .accent-color {
            background-color: #8A9A5B; /* Verde Oliva */
        }
        .accent-color-text {
            color: #8A9A5B;
        }
        .accent-color-border {
            border-color: #8A9A5B;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .price-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #8A9A5B;
            cursor: pointer;
            border-radius: 50%;
        }
        .price-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #8A9A5B;
            cursor: pointer;
            border-radius: 50%;
        }
        .modal, .cart-panel, .checkout-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .cart-panel {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="antialiased">

    <!-- MODAL DE DETALLE DE PRODUCTO -->
    <div id="product-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 opacity-0 pointer-events-none">
        <div id="product-modal-content" class="bg-white rounded-lg shadow-2xl w-11/12 md:w-3/4 lg:w-2/3 max-w-4xl h-5/6 transform scale-95">
            <!-- El contenido se inyecta din√°micamente -->
        </div>
    </div>
    
    <!-- PANEL LATERAL DEL CARRITO -->
    <div id="cart-panel" class="cart-panel fixed top-0 right-0 h-full w-full md:w-1/3 lg:w-1/4 bg-white shadow-2xl z-50 transform translate-x-full">
        <div class="flex flex-col h-full">
            <div class="p-5 flex justify-between items-center border-b">
                <h2 class="text-2xl font-bold">Tu Carrito</h2>
                <button id="close-cart-btn" class="text-3xl font-light">&times;</button>
            </div>
            <div id="cart-items-container" class="flex-grow p-5 overflow-y-auto no-scrollbar">
                <!-- Los art√≠culos del carrito se inyectan aqu√≠ -->
            </div>
            <div class="p-5 border-t">
                <div class="flex justify-between font-bold text-lg mb-4">
                    <span>Subtotal</span>
                    <span id="cart-subtotal">S/ 0.00</span>
                </div>
                <button id="checkout-btn" class="w-full text-white p-3 rounded-lg accent-color hover:opacity-90 transition-opacity">
                    Proceder al Pago
                </button>
            </div>
        </div>
    </div>
    
    <!-- MODAL DE CHECKOUT -->
    <div id="checkout-modal" class="checkout-modal fixed inset-0 bg-white z-50 opacity-0 pointer-events-none overflow-y-auto">
        <div id="checkout-modal-content" class="container mx-auto px-4 py-8">
             <!-- El contenido del checkout se inyecta din√°micamente -->
        </div>
    </div>


    <!-- CONTENIDO PRINCIPAL DE LA P√ÅGINA -->
    <div class="container mx-auto px-4">

        <!-- ENCABEZADO -->
        <header class="py-4 sticky top-0 bg-white/80 backdrop-blur-md z-40 border-b border-gray-200">
            <div class="flex justify-between items-center">
                <a href="#" id="logo-btn" class="text-3xl font-bold accent-color-text">Esvi Atelier</a>
                <nav class="hidden md:flex space-x-8">
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Hombre">Hombre</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Mujer">Mujer</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Infantil">Infantil</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Ofertas">Ofertas</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Novedades">Novedades</a>
                </nav>
                <div class="flex items-center space-x-6">
                    <div class="relative hidden md:block">
                        <input type="search" id="search-bar" placeholder="Buscar..." class="pl-10 pr-4 py-2 w-48 rounded-full border focus:outline-none focus:border-gray-400">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">üîç</span>
                    </div>
                    <button id="user-btn" class="text-2xl">üë§</button>
                    <button id="cart-btn" class="text-2xl relative">
                        <span>üõí</span>
                        <span id="cart-count" class="absolute -top-2 -right-2 accent-color text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button id="mobile-menu-btn" class="md:hidden text-2xl">‚ò∞</button>
                </div>
            </div>
            <!-- Men√∫ M√≥vil -->
            <div id="mobile-menu" class="hidden md:hidden mt-4">
                 <nav class="flex flex-col space-y-4">
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Hombre">Hombre</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Mujer">Mujer</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Infantil">Infantil</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Ofertas">Ofertas</a>
                    <a href="#" class="nav-link text-gray-600 hover:text-black" data-category="Novedades">Novedades</a>
                </nav>
            </div>
        </header>

        <main class="py-8">
            <div class="flex flex-col md:flex-row gap-8">
                <!-- FILTROS -->
                <aside class="w-full md:w-1/4 lg:w-1/5">
                    <h2 class="text-2xl font-bold mb-6">Filtros</h2>
                    <div id="filters-container" class="space-y-6">
                        <!-- Talla -->
                        <div>
                            <h3 class="font-bold mb-2">Talla</h3>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox accent-color" data-filter="talla" value="XS"><span>XS</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox accent-color" data-filter="talla" value="S"><span>S</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox accent-color" data-filter="talla" value="M"><span>M</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox accent-color" data-filter="talla" value="L"><span>L</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox accent-color" data-filter="talla" value="XL"><span>XL</span></label>
                            </div>
                        </div>
                        <!-- Color -->
                        <div>
                            <h3 class="font-bold mb-2">Color</h3>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox hidden" data-filter="color" value="Negro"><span class="h-6 w-6 rounded-full border border-gray-300 block bg-black cursor-pointer"></span></label>
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox hidden" data-filter="color" value="Blanco"><span class="h-6 w-6 rounded-full border border-gray-300 block bg-white cursor-pointer"></span></label>
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox hidden" data-filter="color" value="Azul"><span class="h-6 w-6 rounded-full border border-gray-300 block bg-blue-600 cursor-pointer"></span></label>
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox hidden" data-filter="color" value="Rojo"><span class="h-6 w-6 rounded-full border border-gray-300 block bg-red-600 cursor-pointer"></span></label>
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox hidden" data-filter="color" value="Verde"><span class="h-6 w-6 rounded-full border border-gray-300 block bg-green-600 cursor-pointer"></span></label>
                            </div>
                        </div>
                        <!-- Precio -->
                        <div>
                            <h3 class="font-bold mb-2">Precio</h3>
                            <input type="range" id="price-slider" min="0" max="500" value="500" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer price-slider">
                            <div class="text-right mt-1">Hasta: <span id="price-value">S/ 500</span></div>
                        </div>
                        <!-- Tipo de Prenda -->
                        <div>
                            <h3 class="font-bold mb-2">Tipo de Prenda</h3>
                            <div id="tipo-prenda-filter" class="space-y-1">
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox accent-color" data-filter="tipo" value="Camisa"><span> Camisas</span></label>
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox accent-color" data-filter="tipo" value="Pantal√≥n"><span> Pantalones</span></label>
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox accent-color" data-filter="tipo" value="Vestido"><span> Vestidos</span></label>
                                <label class="flex items-center"><input type="checkbox" class="filter-checkbox accent-color" data-filter="tipo" value="Chompa"><span> Chompas</span></label>
                            </div>
                        </div>
                        <button id="clear-filters-btn" class="w-full border border-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-100 transition-colors">Limpiar Filtros</button>
                    </div>
                </aside>

                <!-- LISTADO DE PRODUCTOS -->
                <section class="w-full md:w-3/4 lg:w-4/5">
                    <h1 id="category-title" class="text-3xl font-bold mb-6">Todos los Productos</h1>
                    <div id="product-grid" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
                        <!-- Las tarjetas de producto se inyectan aqu√≠ -->
                    </div>
                    <div id="no-results" class="hidden text-center py-20">
                        <p class="text-2xl text-gray-500">üòî</p>
                        <p class="mt-4 text-xl text-gray-500">No se encontraron productos que coincidan con tu b√∫squeda.</p>
                    </div>
                </section>
            </div>
        </main>
        
        <!-- PIE DE P√ÅGINA -->
        <footer class="mt-16 py-10 border-t border-gray-200 text-center text-gray-500">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="font-bold text-lg mb-4 text-black">Suscr√≠bete a Novedades</h3>
                    <form class="flex">
                        <input type="email" placeholder="tu@email.com" class="w-full p-2 border border-r-0 rounded-l-lg focus:outline-none">
                        <button type="submit" class="accent-color text-white px-4 rounded-r-lg">Enviar</button>
                    </form>
                </div>
                 <div>
                    <h3 class="font-bold text-lg mb-4 text-black">Atenci√≥n al Cliente</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="hover:underline">Preguntas Frecuentes</a></li>
                        <li><a href="#" class="hover:underline">Pol√≠tica de Devoluciones</a></li>
                        <li><a href="#" class="hover:underline">T√©rminos y Condiciones</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-4 text-black">S√≠guenos</h3>
                    <div class="flex justify-center space-x-4 text-2xl">
                        <a href="#" class="hover:text-black">üì∑</a>
                        <a href="#" class="hover:text-black">üìò</a>
                        <a href="#" class="hover:text-black">üìå</a>
                    </div>
                </div>
            </div>
            <p class="mt-10 text-sm">&copy; 2025 Esvi Atelier. Todos los derechos reservados.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const appState = {
                products: [],
                cart: [],
                filters: {
                    category: 'Todos',
                    talla: [],
                    color: [],
                    tipo: [],
                    maxPrice: 500,
                    searchTerm: ''
                },
                currentView: 'products'
            };

            const mockProducts = [
                { id: 1, name: 'Camisa de Lino Cl√°sica', category: 'Hombre', tipo: 'Camisa', price: 159.90, sizes: ['S', 'M', 'L'], colors: ['Blanco', 'Azul'], material: 'Lino', inStock: true, image: 'https://placehold.co/400x500/F0F8FF/333?text=Camisa+Lino', novelty: true, onSale: false, description: 'Una camisa de lino vers√°til y fresca, perfecta para cualquier ocasi√≥n.'},
                { id: 2, name: 'Pantal√≥n Chino Moderno', category: 'Hombre', tipo: 'Pantal√≥n', price: 189.90, sizes: ['S', 'M', 'L', 'XL'], colors: ['Negro', 'Verde'], material: 'Algod√≥n', inStock: true, image: 'https://placehold.co/400x500/D2B48C/333?text=Pantal√≥n+Chino', novelty: false, onSale: false, description: 'Corte slim-fit para un look moderno y c√≥modo.' },
                { id: 3, name: 'Vestido Floral de Verano', category: 'Mujer', tipo: 'Vestido', price: 229.90, sizes: ['XS', 'S', 'M'], colors: ['Rojo', 'Azul'], material: 'Viscosa', inStock: true, image: 'https://placehold.co/400x500/FFC0CB/333?text=Vestido+Floral', novelty: true, onSale: false, description: 'Ligero y femenino, ideal para los d√≠as de sol.'},
                { id: 4, name: 'Chompa de Alpaca Suave', category: 'Mujer', tipo: 'Chompa', price: 349.90, sizes: ['M', 'L'], colors: ['Blanco', 'Gris'], material: 'Alpaca', inStock: false, image: 'https://placehold.co/400x500/E6E6FA/333?text=Chompa+Alpaca', novelty: false, onSale: true, description: 'Calidez y estilo inigualables con la mejor fibra peruana.'},
                { id: 5, name: 'Polo B√°sico de Algod√≥n', category: 'Hombre', tipo: 'Polo', price: 79.90, sizes: ['S', 'M', 'L', 'XL'], colors: ['Negro', 'Blanco', 'Rojo'], material: 'Algod√≥n Pima', inStock: true, image: 'https://placehold.co/400x500/FFFFFF/333?text=Polo+B√°sico', novelty: false, onSale: false, description: 'La base de cualquier guardarropa, con la suavidad del algod√≥n pima.'},
                { id: 6, name: 'Jean Skinny de Tiro Alto', category: 'Mujer', tipo: 'Pantal√≥n', price: 199.90, sizes: ['S', 'M'], colors: ['Azul'], material: 'Mezclilla', inStock: true, image: 'https://placehold.co/400x500/B0C4DE/333?text=Jean+Skinny', novelty: false, onSale: false, description: 'Dise√±ado para realzar tu figura y ofrecer comodidad todo el d√≠a.'},
                { id: 7, name: 'Conjunto de Buzo Infantil', category: 'Infantil', tipo: 'Conjunto', price: 129.90, sizes: ['XS', 'S'], colors: ['Verde', 'Azul'], material: 'Algod√≥n', inStock: true, image: 'https://placehold.co/400x500/90EE90/333?text=Buzo+Infantil', novelty: true, onSale: false, description: 'Comodidad y diversi√≥n para los m√°s peque√±os de la casa.'},
                { id: 8, name: 'Falda Midi Plisada', category: 'Mujer', tipo: 'Falda', price: 179.90, sizes: ['S', 'M', 'L'], colors: ['Negro', 'Rojo'], material: 'Poli√©ster', inStock: true, image: 'https://placehold.co/400x500/F5DEB3/333?text=Falda+Midi', novelty: false, onSale: true, description: 'Elegancia y movimiento en una prenda atemporal.'}
            ];
            
            appState.products = mockProducts;

            const productGrid = document.getElementById('product-grid');
            const noResultsDiv = document.getElementById('no-results');
            const categoryTitle = document.getElementById('category-title');
            const priceSlider = document.getElementById('price-slider');
            const priceValue = document.getElementById('price-value');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const searchBar = document.getElementById('search-bar');
            
            const productModal = document.getElementById('product-modal');
            const productModalContent = document.getElementById('product-modal-content');

            const cartPanel = document.getElementById('cart-panel');
            const cartBtn = document.getElementById('cart-btn');
            const closeCartBtn = document.getElementById('close-cart-btn');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartSubtotalEl = document.getElementById('cart-subtotal');
            const cartCountEl = document.getElementById('cart-count');

            const checkoutBtn = document.getElementById('checkout-btn');
            const checkoutModal = document.getElementById('checkout-modal');
            const checkoutModalContent = document.getElementById('checkout-modal-content');
            
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');

            const renderProducts = () => {
                productGrid.innerHTML = '';
                let filteredProducts = [...appState.products];

                if (appState.filters.category !== 'Todos') {
                    if (appState.filters.category === 'Ofertas') {
                        filteredProducts = filteredProducts.filter(p => p.onSale);
                    } else if (appState.filters.category === 'Novedades') {
                        filteredProducts = filteredProducts.filter(p => p.novelty);
                    } else {
                        filteredProducts = filteredProducts.filter(p => p.category === appState.filters.category);
                    }
                }

                if (appState.filters.talla.length > 0) {
                    filteredProducts = filteredProducts.filter(p => p.sizes.some(s => appState.filters.talla.includes(s)));
                }
                
                if (appState.filters.color.length > 0) {
                    filteredProducts = filteredProducts.filter(p => p.colors.some(c => appState.filters.color.includes(c)));
                }
                
                if (appState.filters.tipo.length > 0) {
                    filteredProducts = filteredProducts.filter(p => appState.filters.tipo.includes(p.tipo));
                }

                filteredProducts = filteredProducts.filter(p => p.price <= appState.filters.maxPrice);

                if (appState.filters.searchTerm) {
                    filteredProducts = filteredProducts.filter(p => p.name.toLowerCase().includes(appState.filters.searchTerm.toLowerCase()));
                }

                if (filteredProducts.length === 0) {
                    noResultsDiv.classList.remove('hidden');
                    productGrid.classList.add('hidden');
                } else {
                    noResultsDiv.classList.add('hidden');
                    productGrid.classList.remove('hidden');
                    filteredProducts.forEach(product => {
                        const card = document.createElement('div');
                        card.className = 'bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-xl transition-shadow duration-300 cursor-pointer group';
                        card.dataset.productId = product.id;
                        card.innerHTML = `
                            <div class="relative">
                                <img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover">
                                ${product.onSale ? '<span class="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">OFERTA</span>' : ''}
                                ${product.novelty ? '<span class="absolute top-2 right-2 accent-color text-white text-xs px-2 py-1 rounded">NUEVO</span>' : ''}
                                <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-40 p-4 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <h3 class="font-bold text-lg">${product.name}</h3>
                                    <p class="text-md">S/ ${product.price.toFixed(2)}</p>
                                </div>
                            </div>
                        `;
                        productGrid.appendChild(card);
                    });
                }
            };
            
            const openProductModal = (productId) => {
                const product = appState.products.find(p => p.id == productId);
                if (!product) return;

                productModalContent.innerHTML = `
                    <div class="flex flex-col md:flex-row h-full">
                        <div class="md:w-1/2 h-1/2 md:h-full bg-cover bg-center" style="background-image: url('${product.image}')"></div>
                        <div class="md:w-1/2 p-6 md:p-8 flex flex-col overflow-y-auto no-scrollbar">
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h2 class="text-3xl font-bold mb-2">${product.name}</h2>
                                    <button id="close-modal-btn" class="text-3xl font-light">&times;</button>
                                </div>
                                <p class="text-2xl accent-color-text font-bold mb-4">S/ ${product.price.toFixed(2)}</p>
                                <p class="text-gray-600 mb-6">${product.description}</p>
                                
                                <div class="mb-6">
                                    <h4 class="font-bold mb-2">Talla:</h4>
                                    <div class="flex flex-wrap gap-2">
                                        ${product.sizes.map(size => `<label><input type="radio" name="size" value="${size}" class="sr-only peer"><span class="px-4 py-2 border rounded-lg cursor-pointer peer-checked:bg-gray-800 peer-checked:text-white">${size}</span></label>`).join('')}
                                    </div>
                                </div>
                                <div class="mb-6">
                                    <h4 class="font-bold mb-2">Color:</h4>
                                     <div class="flex flex-wrap gap-3">
                                        ${product.colors.map(color => `<label><input type="radio" name="color" value="${color}" class="sr-only peer"><span class="h-8 w-8 rounded-full border-2 border-transparent peer-checked:border-gray-800 block cursor-pointer" style="background-color: ${color.toLowerCase() === 'blanco' ? 'white' : color.toLowerCase()}; border-color: ${color.toLowerCase() === 'blanco' ? '#ccc' : 'transparent'};"></span></label>`).join('')}
                                    </div>
                                </div>
                            </div>
                            <div class="mt-auto">
                                <button data-product-id="${product.id}" class="add-to-cart-btn w-full text-white p-3 rounded-lg accent-color hover:opacity-90 transition-opacity">
                                    Agregar al Carrito
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                productModal.classList.remove('opacity-0', 'pointer-events-none');
                productModalContent.classList.remove('scale-95');

                document.getElementById('close-modal-btn').addEventListener('click', () => {
                    productModal.classList.add('opacity-0', 'pointer-events-none');
                    productModalContent.classList.add('scale-95');
                });

                document.querySelector('.add-to-cart-btn').addEventListener('click', (e) => {
                    const selectedSize = document.querySelector('input[name="size"]:checked');
                    const selectedColor = document.querySelector('input[name="color"]:checked');
                    if (!selectedSize || !selectedColor) {
                        alert('Por favor, selecciona talla y color.');
                        return;
                    }
                    addToCart(product.id, selectedSize.value, selectedColor.value);
                    productModal.classList.add('opacity-0', 'pointer-events-none');
                    productModalContent.classList.add('scale-95');
                    openCartPanel();
                });
            };

            const renderCart = () => {
                cartItemsContainer.innerHTML = '';
                if(appState.cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="text-gray-500 text-center">Tu carrito est√° vac√≠o.</p>';
                    checkoutBtn.disabled = true;
                    checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    let subtotal = 0;
                    appState.cart.forEach(item => {
                        const product = appState.products.find(p => p.id === item.id);
                        subtotal += product.price * item.quantity;
                        const cartItemEl = document.createElement('div');
                        cartItemEl.className = 'flex gap-4 mb-4';
                        cartItemEl.innerHTML = `
                            <img src="${product.image}" alt="${product.name}" class="w-20 h-24 object-cover rounded-lg">
                            <div class="flex-grow">
                                <h4 class="font-bold">${product.name}</h4>
                                <p class="text-sm text-gray-500">Talla: ${item.size}, Color: ${item.color}</p>
                                <p class="font-bold text-lg">S/ ${(product.price * item.quantity).toFixed(2)}</p>
                            </div>
                            <div class="flex flex-col items-center justify-between">
                                <button class="cart-item-remove text-red-500 text-xl" data-item-id="${item.itemId}">&times;</button>
                                <div class="flex items-center border rounded-lg">
                                    <button class="cart-quantity-change px-2" data-item-id="${item.itemId}" data-change="-1">-</button>
                                    <span class="px-2">${item.quantity}</span>
                                    <button class="cart-quantity-change px-2" data-item-id="${item.itemId}" data-change="1">+</button>
                                </div>
                            </div>
                        `;
                        cartItemsContainer.appendChild(cartItemEl);
                    });
                    cartSubtotalEl.textContent = `S/ ${subtotal.toFixed(2)}`;
                    checkoutBtn.disabled = false;
                    checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                cartCountEl.textContent = appState.cart.reduce((total, item) => total + item.quantity, 0);
            };

            const addToCart = (productId, size, color) => {
                const existingItemIndex = appState.cart.findIndex(item => item.id === productId && item.size === size && item.color === color);
                if(existingItemIndex > -1) {
                    appState.cart[existingItemIndex].quantity++;
                } else {
                    appState.cart.push({
                        itemId: Date.now(),
                        id: productId,
                        quantity: 1,
                        size,
                        color
                    });
                }
                renderCart();
            };

            const updateCartQuantity = (itemId, change) => {
                const itemIndex = appState.cart.findIndex(item => item.itemId == itemId);
                if (itemIndex > -1) {
                    appState.cart[itemIndex].quantity += change;
                    if (appState.cart[itemIndex].quantity <= 0) {
                        appState.cart.splice(itemIndex, 1);
                    }
                }
                renderCart();
            };
            
            const renderCheckout = (step = 1) => {
                closeCartPanel();
                let content = '';
                const subtotal = appState.cart.reduce((sum, item) => {
                    const product = appState.products.find(p => p.id === item.id);
                    return sum + (product.price * item.quantity);
                }, 0);
                const shipping = 10;
                const total = subtotal + shipping;

                if (step === 1) { // Informaci√≥n de Env√≠o
                    content = `
                        <button id="close-checkout-btn" class="absolute top-4 right-4 text-3xl">&times;</button>
                        <h2 class="text-3xl font-bold mb-2">Checkout</h2>
                        <div class="text-sm text-gray-500 mb-6">Paso 1 de 3: Informaci√≥n de Env√≠o</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <form id="shipping-form">
                                    <div class="space-y-4">
                                        <input type="text" placeholder="Nombre completo" required class="w-full p-3 border rounded-lg">
                                        <input type="email" placeholder="Correo electr√≥nico" required class="w-full p-3 border rounded-lg">
                                        <input type="text" placeholder="Direcci√≥n" required class="w-full p-3 border rounded-lg">
                                        <div class="flex gap-4">
                                            <input type="text" placeholder="Ciudad" required class="w-full p-3 border rounded-lg">
                                            <input type="text" placeholder="C√≥digo Postal" class="w-full p-3 border rounded-lg">
                                        </div>
                                        <input type="tel" placeholder="Tel√©fono" required class="w-full p-3 border rounded-lg">
                                    </div>
                                    <button type="submit" class="w-full mt-6 text-white p-3 rounded-lg accent-color hover:opacity-90">Continuar a Revisi√≥n</button>
                                </form>
                            </div>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <h3 class="font-bold text-xl mb-4">Resumen de tu Orden</h3>
                                <!-- Resumen de productos -->
                                <div class="space-y-2 mb-4 border-b pb-4">
                                    ${appState.cart.map(item => {
                                        const product = appState.products.find(p => p.id === item.id);
                                        return `<div class="flex justify-between text-sm"><span class="truncate pr-4">${item.quantity} x ${product.name}</span><span>S/ ${(product.price * item.quantity).toFixed(2)}</span></div>`;
                                    }).join('')}
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between"><span class="text-gray-600">Subtotal</span><span>S/ ${subtotal.toFixed(2)}</span></div>
                                    <div class="flex justify-between"><span class="text-gray-600">Env√≠o</span><span>S/ ${shipping.toFixed(2)}</span></div>
                                    <div class="flex justify-between font-bold text-lg mt-2"><span >Total</span><span>S/ ${total.toFixed(2)}</span></div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (step === 2) { // Revisi√≥n de pedido
                    content = `
                         <button id="close-checkout-btn" class="absolute top-4 right-4 text-3xl">&times;</button>
                        <h2 class="text-3xl font-bold mb-2">Checkout</h2>
                        <div class="text-sm text-gray-500 mb-6">Paso 2 de 3: Revisi√≥n de Pedido</div>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h3 class="font-bold mb-2">Direcci√≥n de Env√≠o</h3>
                                    <p class="text-gray-600">John Doe<br>Av. Siempre Viva 123<br>Lima, 15023<br>Per√∫</p>
                                    <button class="text-sm accent-color-text mt-2" onclick="window.renderCheckout(1)">Editar</button>
                                </div>
                                <h3 class="font-bold text-xl mb-4">Items del Pedido</h3>
                                 <div class="space-y-4">
                                    ${appState.cart.map(item => {
                                        const product = appState.products.find(p => p.id === item.id);
                                        return `<div class="flex gap-4"><img src="${product.image}" class="w-16 h-20 rounded-md object-cover"><div class="flex-grow"><p class="font-bold">${product.name}</p><p class="text-sm text-gray-500">${item.size}, ${item.color}</p></div><p>S/ ${product.price.toFixed(2)}</p></div>`;
                                    }).join('')}
                                </div>
                            </div>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <h3 class="font-bold text-xl mb-4">Resumen Final</h3>
                                 <div class="space-y-1 mb-6 border-b pb-4">
                                    <div class="flex justify-between"><span class="text-gray-600">Subtotal</span><span>S/ ${subtotal.toFixed(2)}</span></div>
                                    <div class="flex justify-between"><span class="text-gray-600">Env√≠o</span><span>S/ ${shipping.toFixed(2)}</span></div>
                                </div>
                                <div class="flex justify-between font-bold text-lg mb-6"><span >Total a Pagar</span><span>S/ ${total.toFixed(2)}</span></div>
                                <button id="to-payment-btn" class="w-full mt-6 text-white p-3 rounded-lg accent-color hover:opacity-90">Continuar al Pago</button>
                            </div>
                        </div>
                    `;
                } else if (step === 3) { // Pago
                    content = `
                        <button id="close-checkout-btn" class="absolute top-4 right-4 text-3xl">&times;</button>
                        <h2 class="text-3xl font-bold mb-2">Checkout</h2>
                        <div class="text-sm text-gray-500 mb-6">Paso 3 de 3: M√©todo de Pago</div>
                        <div class="max-w-md mx-auto">
                            <p class="text-center text-lg mb-4">Total a pagar: <span class="font-bold">S/ ${total.toFixed(2)}</span></p>
                            <div class="space-y-4">
                                <div class="border p-4 rounded-lg">
                                    <label class="font-bold flex items-center"><input type="radio" name="payment" class="mr-2 accent-color"><span>Tarjeta de Cr√©dito/D√©bito</span></label>
                                </div>
                                <div class="border p-4 rounded-lg">
                                    <label class="font-bold flex items-center"><input type="radio" name="payment" class="mr-2 accent-color"><span>Yape / Plin</span></label>
                                    <p class="text-sm text-gray-600 mt-2 ml-6">Paga a trav√©s de Yape o Plin al n√∫mero 987 654 321. Env√≠a tu comprobante a ventas@esvi.com</p>
                                </div>
                                <div class="border p-4 rounded-lg">
                                    <label class="font-bold flex items-center"><input type="radio" name="payment" class="mr-2 accent-color"><span>Transferencia Bancaria</span></label>
                                     <p class="text-sm text-gray-600 mt-2 ml-6">BCP: 123-456789-0-12<br>BBVA: 001-123-000456789<br>Interbank: 890-1234567890</p>
                                </div>
                            </div>
                             <button id="finish-order-btn" class="w-full mt-6 text-white p-3 rounded-lg accent-color hover:opacity-90">Finalizar Pedido</button>
                        </div>
                    `;
                } else if (step === 4) { // Confirmaci√≥n
                     content = `
                        <div class="text-center py-20">
                            <p class="text-6xl mb-4">üéâ</p>
                            <h2 class="text-4xl font-bold mb-2">¬°Gracias por tu compra!</h2>
                            <p class="text-gray-600 mb-6">Hemos recibido tu pedido. Recibir√°s un correo de confirmaci√≥n pronto.</p>
                            <button id="back-to-shop-btn" class="accent-color text-white px-8 py-3 rounded-lg">Seguir Comprando</button>
                        </div>
                     `;
                }
                
                checkoutModalContent.innerHTML = content;
                checkoutModal.classList.remove('opacity-0', 'pointer-events-none');

                document.getElementById('close-checkout-btn')?.addEventListener('click', closeCheckoutModal);
                
                const shippingForm = document.getElementById('shipping-form');
                shippingForm?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    renderCheckout(2);
                });
                
                document.getElementById('to-payment-btn')?.addEventListener('click', () => renderCheckout(3));

                document.getElementById('finish-order-btn')?.addEventListener('click', () => {
                    appState.cart = [];
                    renderCart();
                    renderCheckout(4);
                });
                
                document.getElementById('back-to-shop-btn')?.addEventListener('click', closeCheckoutModal);
            };

            const openCartPanel = () => cartPanel.classList.remove('translate-x-full');
            const closeCartPanel = () => cartPanel.classList.add('translate-x-full');
            const closeCheckoutModal = () => checkoutModal.classList.add('opacity-0', 'pointer-events-none');
            window.renderCheckout = renderCheckout;

            document.querySelectorAll('.filter-checkbox').forEach(cb => {
                cb.addEventListener('change', (e) => {
                    const filterType = e.target.dataset.filter;
                    const value = e.target.value;
                    if (e.target.checked) {
                        appState.filters[filterType].push(value);
                    } else {
                        appState.filters[filterType] = appState.filters[filterType].filter(item => item !== value);
                    }
                    renderProducts();
                });
            });

            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    appState.filters.category = e.target.dataset.category;
                    categoryTitle.textContent = e.target.dataset.category === 'Todos' ? 'Todos los Productos' : e.target.dataset.category;
                    renderProducts();
                    if(mobileMenu.classList.contains('block')) {
                        mobileMenu.classList.remove('block');
                        mobileMenu.classList.add('hidden');
                    }
                });
            });
            
            document.getElementById('logo-btn').addEventListener('click', (e) => {
                 e.preventDefault();
                 appState.filters.category = 'Todos';
                 categoryTitle.textContent = 'Todos los Productos';
                 renderProducts();
            });

            priceSlider.addEventListener('input', (e) => {
                appState.filters.maxPrice = parseInt(e.target.value);
                priceValue.textContent = `S/ ${e.target.value}`;
                renderProducts();
            });
            
            searchBar.addEventListener('input', (e) => {
                appState.filters.searchTerm = e.target.value;
                renderProducts();
            });

            clearFiltersBtn.addEventListener('click', () => {
                document.querySelectorAll('.filter-checkbox').forEach(cb => cb.checked = false);
                priceSlider.value = 500;
                priceValue.textContent = 'S/ 500';
                appState.filters.talla = [];
                appState.filters.color = [];
                appState.filters.tipo = [];
                appState.filters.maxPrice = 500;
                renderProducts();
            });
            
            productGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.group');
                if (card) {
                    openProductModal(card.dataset.productId);
                }
            });
            
            cartBtn.addEventListener('click', openCartPanel);
            closeCartBtn.addEventListener('click', closeCartPanel);
            
            cartItemsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('cart-item-remove')) {
                    const itemId = e.target.dataset.itemId;
                    appState.cart = appState.cart.filter(item => item.itemId != itemId);
                    renderCart();
                } else if (e.target.classList.contains('cart-quantity-change')) {
                    const itemId = e.target.dataset.itemId;
                    const change = parseInt(e.target.dataset.change);
                    updateCartQuantity(itemId, change);
                }
            });
            
            checkoutBtn.addEventListener('click', () => renderCheckout(1));
            
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                mobileMenu.classList.toggle('block');
            });

            renderProducts();
            renderCart();
        });
    </script>
</body>
</html>
